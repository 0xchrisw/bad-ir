#! /usr/bin/env python3
# Enable Developer Mode

import os
import platform
import time

from pathlib import Path


class RokuRemote:
  commands = {
    'UP': [
      [0,8980,4473,551,558,515,1695,510,567,517,1687,518,565,519,1686,519,1706,499,1681,524,559,525,1679,526,559,524,560,524,595,489,559,525,1677,518,1685,520,1685,520,565,519,563,521,1682,524,1681,524,561,523,559,525,1681,524,559,525,1678,555,1649,519,569,515,565,518,1684,522,1682,523,559,525]
    ],

    'DOWN': [[0,8989,4478,548,535,549,1658,548,536,548,1658,548,535,549,1656,550,1654,551,1656,550,534,550,1656,550,535,549,537,547,538,546,538,546,1658,548,1658,547,1657,550,1657,548,537,547,537,547,1658,548,1658,564,522,546,540,545,541,543,541,543,1662,544,1662,544,542,552,531,542,1664,542,1662,544]],

    'LEFT': [
      [0,8978,4485,571,511,542,1665,551,532,552,1654,552,531,573,1631,544,1662,544,1662,574,510,574,1632,543,542,542,543,551,535,570,513,571,1633,541,1666,550,533,551,1653,573,1632,574,1631,575,1631,544,541,542,541,543,1662,574,1633,575,510,551,534,549,536,548,536,548,1656,549,1658,568,514,549]
      ],

    'RIGHT': [
      [0,8985,4474,552,532,552,1654,542,541,543,1662,543,539,545,1658,548,1656,550,1657,549,534,550,1655,550,535,549,536,548,537,547,537,547,1656,550,1654,590,1616,551,531,543,1660,545,1660,546,537,582,1623,547,536,547,1659,547,536,547,1658,548,537,547,536,548,1657,548,557,527,1656,550,533,550]
    ],

    'SELECT': [[0,8985,4481,546,538,546,1661,546,538,546,1661,545,539,545,1660,546,1659,548,1659,547,537,547,1659,547,539,545,541,543,542,575,509,543,1662,544,1664,542,541,544,1663,560,523,544,1663,543,540,544,1663,543,543,552,532,552,1655,551,532,552,1655,551,533,552,1655,551,532,552,1653,543,1661,545]],

    'BACK': [[0,8986,4479,547,537,547,1660,546,537,548,1659,547,536,548,1657,549,1656,551,1657,552,532,549,1658,580,506,547,538,577,509,544,539,546,1659,578,1630,576,508,545,1660,547,1659,578,508,545,539,576,1628,579,1628,578,507,577,1630,577,508,576,508,545,1659,578,1629,577,509,584,499,577,1628,547]],

    'HOME': [[0,8987,4475,551,558,526,1654,552,557,527,1653,553,556,519,1659,545,1659,546,1661,545,564,520,1659,546,565,519,567,517,568,526,569,504,1661,545,1659,546,1658,547,1664,542,537,546,539,545,540,544,541,553,530,544,1664,551,546,538,533,551,1653,552,1651,544,1659,547,1657,548,1658,548,535,570]]
  }

  def __init__(self):
    project_dir = Path().resolve()
    flirc = {
      'darwin': str(Path(project_dir / "bin/darwin/flirc_util")),
    }

    self.bin = flirc[platform.system().lower()]
    self.username = "rokudev"
    self.password = "rokudev"


  def code_to_string(self, command):
    return ','.join([str(i) for i in command])


  def send_command(self, command):
    output = []
    for part in command:
      cmd = self.code_to_string(part)
      flirc_command = " ".join([
        self.bin,
          f"sendir",
          # f"--ik=23000",
          # f"--repeat=3",
          f"--pattern={cmd}",
          f"--kill"
      ])
      output.append(os.popen(flirc_command).read())
    return output


  def enable_developer_mode(self, verbose=True):
    # TODO: RIGHT Key
    macro = [
      "HOME",  "HOME", "HOME",
      "UP",    "UP",
      "RIGHT", "LEFT",
      "RIGHT", "LEFT",
      "RIGHT",
      # "SELECT",  # Enable & Restart
      # "UP",      # Security Warning
      # "SELECT",   # These are not the warnings you are looking for...
      # "SELECT",
      # "SELECT",
      # # Enter password here
    ]
    for key in macro:
      _key = self.commands[key]
      if verbose:
        print(f"Sending key: {key}")
      self.send_command(_key)
      time.sleep(0.75)


remote = RokuRemote()
remote.enable_developer_mode()


#####
## Roku IR Protocol
####
## NEC Remote Protocol
# 32  |
# 28  | Compliment
# 24  |
# 20  |
# -----------------------
# 16  |
# 12  |
#  8  | System Code
#  4  |